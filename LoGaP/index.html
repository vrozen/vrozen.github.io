<html>
<meta charset="utf-8">

<style>
  .wrapper {
    position: relative;
  }
  
  .graph {
    height: 100%;
    width: 100%;
  }

  .title {
    height: 30px;
    width: 240px;
    display: flex;
    align-items: center;	
    font-family: Helvetica;
    font-size: 14px;
    font-weight: bold;
    color: white;
    vertical-align: middle;	  
    padding: 0px 10px;    
  }

  .menuTabOff {
    height: 30px;
    width: 110px;
    display: flex;
    align-items: center;	
    font-family: Helvetica;
    font-size: 14px;
    font-weight: bold;
    color: white;
    justify-content: center;
    align-items: center;
    align-content: center; 
  }

  .menuTabOn {
    background-color: white;
    height: 30px;
    width: 110px;
    display: flex;
    justify-content: center;
    align-items: center;
    align-content: center;
    color: black;
    font-family: Helvetica;
    font-size: 14px;
    font-weight: bold;
  }
  
  .menuItem {
    height: 24px;
    display: flex;
    align-items: center;	
    font-family: Helvetica;
    font-size: 12px;
    font-weight: bold;
    vertical-align: middle;	
  }
  
  .menuLabel {
    width: 50px;	
  }
  
  .author {
    font-family: Helvetica;
    font-size: 9px;
    vertical-align: middle;
  }
      
  .menuInput {
    width: 50px;
  }
  
  .menuItemCenter {
    width: 30px;
    text-align: center;
  }
  
  .yearInput {
    width: 40px;
  }

  .centerPageBig {
    background-color: white;
    position: absolute;
    visibility: visible;
    height: 800px;
    width: 640px;
    top: 30;
    left: 190;
    padding: 5px 5px;	
  }

  .centerPageSmall {
    background-color: white;
    position: absolute;
    visibility: hidden;
    height: 480px;
    width: 640px;
    top: 30;
    left: 190;
    padding: 5px 5px;	
  } 

  .centerPageText {
    padding: 5px 5px;	
  } 

  .photo {
    width: 100pt;
    position: relative;
    display: flex;     
    left: 360pt;
    top: -200pt;
  }

  #menuBar {
    background-color: steelblue;	
    position: absolute;
    display: flex;    
    height: 30px;
    width: 100%;
    top: 0;
    left: 0;
  }

  #controlsBar {
    background-color: lightsteelblue;	
    position: absolute;
    display: flex;
    height: 100%;
    width: 170;
    top: 0;
    left: 0;
    padding: 5px 10px;    
  } 
  
  #controls {
    background-color: lightsteelblue;		
    position: absolute;
    height: 200px;
    width: 170px;
    top: 30;
    left: 0;
    padding: 5px 10px;
  }
  
  #paperInfo {
    background-color:lightsteelblue;		
    position: absolute;
    height: 390px;
    width: 170px;
    top: 210;
    left: 0;
    padding: 5px 10px;
    font-size: 11px;
  }
  
  #viewer {	
    position: absolute;
    visibility: hidden;
    height: 640px;
    width: 1280px;
    top: 30;
    left: 190;
    padding: 5px 5px;		
  }
</style>

<body>
<div id="controlsBar"></div>

<div id="menuBar">
  <div class="title">Languages of Games and Play</div>
  <div class="menuTabOn" id="WelcomeTab">Welcome</div>
  <div class="menuTabOff" id="ViewerTab">Paper</div>
  <div class="menuTabOff" id="CloseTab">Map</div>  
  <div class="menuTabOff" id="AboutTab">About</div>  
  <div class="menuTabOff" id="HelpTab">Help</div>
</div>

<div class="graph"><svg id='viz'></svg></div>

<div id="controls">
  <div class="menuItem">Search Controls</div>
  <div class="menuItem">
    <div class="menuLabel">Author</div>
    <div class="menuInput"><input type="text" id="author" size="14"></input></div>					
  </div>
  <div class="menuItem">
    <div class="menuLabel">Title</div>
	  <div class="menuInput"><input type="text" id="title" size="14"></input></div>
  </div>
  <div class="menuItem">
    <div class="menuLabel">Year</div>
	  <div class="yearInput"><input type="text" id="lowYear" maxlength="4" size="4"></input></div>
	  <div class="menuItemCenter">until</div>
    <div class="yearInput"><input type="text" id="highYear" maxlength="4" size="4"></input></div>
  </div>
  <hr>
  <div class="menuItem">Language Selection</div>			
  <div class="menuItem">
	  <div class="menuInput"><select id="language" size="1"><option value=""></option></select></div>					
  </div>
  <hr>
</div>

<div id="paperInfo"><div class='menuItem'>Publication Data</div></div>  

<div id="viewer"><iframe id="viewerFrame" src="pdfjs/web/viewer.html"></iframe> </div>

<div id="Welcome" class="centerPageBig">
<img width="100%" src="LoGaP.jpg">
<div class="centerPageText">
<pre>
                                                    Amsterdam, January 20th 2021
<b>Welcome!</b>

<i>Languages of Games and Play</i> (LoGaP) are language-centric approaches for tackling
challenges and solving problems related to game design and game development.

This website is an interactive version of a systematic mapping study on Languages
of Games and Play that wraps the journal article <b>[1]</b> (and its appendix)
and provides additional features. It is based on Chapter 2 of my PhD thesis <b>[2]</b>.

Here, our goal is to identify what informs the design of good games in order to
help speed-up the game development process for creating better games more quickly.
In particular, we study to what extent <i>languages, structured notations, patterns
and tools</i>, can offer designers and developers theoretical foundations, systematic
techniques and practical solutions they need to raise their productivity and
improve the quality of games and play. Our map contributes:
<ul><li>An overview of research areas and publication venues.</li>
<li>A set of 14 perspectives on LoGaP synthesized from summaries of over
100 distinct languages we identified in over 1400 publications.</li>
<li>An analysis of general trends and success factors of the identified
research, and one unifying specific perspective on <i>Automated Game Gesign</i>,
which discusses challenges and opportunities for directions in future R&D.</li></ul>This website is intended as a <i>'living document'</i> that remains up-to-date.
Please feel free to contact me if you have comments or questions, 
if you wish to discuss a topic or if you found bugs.
In case you want to cite the article, please find the BibTeX <a a target='_blank' href="https://vrozen.github.io/LoGaP/LoGaP_vRozen2020.bib"">here</a>.

Best regards,
Riemer van Rozen

email: rozen[at]cwi[dot]nl | twitter: <a target='_blank' href="https://twitter.com/rvrozen">@rvrozen</a>

<b>References</b>
<b>[1]</b> R. van Rozen. “Languages of Games and Play: A Systematic Mapping Study”.
    In: ACM Comput. Surv. 53.6 (Dec. 2020). DOI: <a target='_blank' href="http://www.doi.org/10.1145/3412843">10.1145/3412843</a>. <a target='_blank' href="https://vrozen.github.io/LoGaP/pdfjs/web/LoGaP_vRozen2020.pdf">[PDF]</a> <a a target='_blank' href="https://vrozen.github.io/LoGaP/LoGaP_vRozen2020.bib"">[BibTeX]</a>. 
<b>[2]</b> R. van Rozen. "Languages of Games and Play: Automating Game Design &
    Enabling Live Programming". PhD thesis. University of Amsterdam, Feb. 2020.
    URL: <a target='_blank' href="https://hdl.handle.net/11245.1/5b899657-b786-46e0-815b-be669f002514">https://hdl.handle.net/11245.1/5b899657-b786-46e0-815b-be669f002514</a>
</pre>
</div>
</div>

<div id="about" class="centerPageSmall">
<img width="100%" src="LoGaP.jpg">
<div class="centerPageText">
<pre>
<b>About the author</b>

Riemer van Rozen is a postdoctoral researcher at Centrum
Wiskunde & Informatica (CWI) and a lecturer of Software
Evolution at the University of Amsterdam (UvA).

Since 2011 he has collaborated with industry in several
applied research projects on languages and tools that
speed-up development and improve software quality.

His research focuses on generic solutions for domain-
specific languages and live programming environments
in general, and automated game design in particular.

This research was funded under the NWO/SIA grants
Early Quality Assurance in Software Production,
Automated Game Design and Live Game Design.
The work has been performed in collaboration with the
Amsterdam University of Applied Sciences (AUAS).

<img width="100pt" class="photo" src="rozen_new_small.jpg">
</pre>
</div>
</div>

<div id="help" class="centerPageSmall">
<img width="100%" src="LoGaP.jpg">
<div class="centerPageText">
<pre>
<b>This interactive map offers the following features:</b>
<ul><li>Use the menu bar at the top for selecting a page (or tab) to view.</li>
<li>Select the 'Paper' tab for reading the article in a built-in PDF viewer.</li>
<li>Select the 'Map' tab to enable the main view. It shows the map as a graph
of publications (nodes) and citations (edges) between them, where <span style='color:green'>green</span>
and <span style='color:red'>red</span> nodes respectively represent included and excluded publications.</li>
<li>Zoom in and out for inspecting parts of the graph.</li>
<li>Search and filter publications by author name, title or year
or select a language by using the 'Search Controls' on the left.</li>
<li>Click on the <span style='color:green'>green</span> nodes to inspect the bibliographic data
of a publication in the 'Publication Data' area on the left.</li>
<li>When selecting a publication or a language, the built-in PDF viewer
finds the associated language summary inside the article.</li></ul>
</pre>
</div>
</div>   
</body>

<script src="d3.js"></script>
<script src="nodes.js"></script>
<script src="edges.js"></script>

<script>
//For more information, visit <a target='_blank' href="http://vrozen.github.io.">http://vrozen.github.io</a>
//https://bl.ocks.org/mapio/53fed7d84cd1812d6a6639ed7aa83868
//Massimo Santini’s Block 53fed7d84cd1812d6a6639ed7aa83868
//Updated June 4, 2019
//license: GPL v3 
var width = window.innerWidth; 
var height = window.innerHeight; 


var storeNodes = [];
var storeEdges = [];

var paperFields = [];


//var paperFields = ["kind", "key", "author", "title", "editors", "booktitle", "pages", "series", "publisher", "year", "isbn", "language", "msid", "editor", "doi", "institution", "issn", "volume", "journal", "number", "month", "keywords", "type", "moth", "note", "urldate", "may", "url", "keyword", "school", "publsiher", "howpublished", "edition", "organization", "address", "issue", "day", "insitution"]

//var paperFields = ["author", "title", "booktitle", "insitution", "organization", "editors", "pages", "series", "publisher", "year", "isbn", "language",  "editor", "institution", "volume", "journal", "number", "month", "keywords", "type", "moth",  "keyword", "school", "publsiher", "howpublished", "edition",  "address", "issue", "day", "doi", "issn", "url", "urldate", "note", "msid"]
		
_nodes.forEach(function(paper) {		
  for (var field of Object.keys(paper)){
    if(!paperFields.includes(field))
    {
	  paperFields.push(field);
    }
  }
});
		
_nodes.forEach(function(n) { storeNodes.push(n); n.visible = true;});
_edges.forEach(function(n) { storeEdges.push(n); });

//var color = d3.scaleOrdinal(d3.schemeCategory10);

//d3.select("summary").attr("visibility", "visible");
		
//d3.json("miserables.json").then(function(graph) {

var adjlist = [];

_edges.forEach(function(d) {
    adjlist[d.source.index + "-" + d.target.index] = true;
    adjlist[d.target.index + "-" + d.source.index] = true;
});

function neigh(a, b) {
    return a == b || adjlist[a + "-" + b];
}

var welcomeTab = d3.select("#WelcomeTab");
var viewerTab = d3.select("#ViewerTab");
var helpTab = d3.select("#HelpTab");
var aboutTab = d3.select("#AboutTab");
var closeTab = d3.select("#CloseTab");

var svg = d3.select("#viz");
var viewerFrame = d3.select("#viewerFrame");
var viewer = d3.select("#viewer");
var welcome = d3.select("#welcome");
var about = d3.select("#about");
var help = d3.select("#help");
var paperInfo = d3.select("#paperInfo");

function resize()
{
  width = window.innerWidth; 
  height = window.innerHeight;
  
  var viewerWidth = width - 210;
  var viewerHeight = height - 50;

  if(width < 800){ viewerWidth = 640; }
  if(height < 600){ viewerHeight = 600; }

  svg
    .attr("width", width)
		.attr("height", height);

  viewerFrame
    .attr("width", viewerWidth)
    .attr("height", viewerHeight);  
}

window.onresize = resize;

resize();

function clearTabs()
{
  viewer.style("visibility", "hidden");
  viewerFrame.style("visibility", "hidden");
  welcome.style("visibility", "hidden");
  about.style("visibility", "hidden"); 
  help.style("visibility", "hidden");

  welcomeTab.attr("class", "menuTabOff");
  viewerTab.attr("class", "menuTabOff");
  aboutTab.attr("class", "menuTabOff");  
  closeTab.attr("class", "menuTabOff");
  helpTab.attr("class", "menuTabOff");
}

welcomeTab.on("click", function(d){
  clearTabs();
  welcome.style("visibility", "visible");
  welcomeTab.attr("class", "menuTabOn");
});
		
viewerTab.on("click", function(d){
  clearTabs();  
  viewer.style("visibility", "visible");
  viewerFrame.style("visibility", "visible");
  viewerTab.attr("class", "menuTabOn");
});

aboutTab.on("click", function(d){
  clearTabs();  
  about.style("visibility", "visible"); 
  aboutTab.attr("class", "menuTabOn");
});

helpTab.on("click", function(d){
  clearTabs();  
  help.style("visibility", "visible"); 
  helpTab.attr("class", "menuTabOn");
});

closeTab.on("click", function(d){
  clearTabs();
  closeTab.attr("class", "menuTabOn");  
});

		
var link, node, labelNode, graphLayout, container;
update();

function update()
{
  svg.selectAll("*").remove();

  var defs = svg.append('defs');

  defs.append('marker')
        .attr('id', 'arrowHead')
        .attr('viewBox','-0 -5 10 10')
        .attr('refX',20)
        .attr('refY',0)
        .attr('orient','auto')
        .attr('markerWidth',5)
        .attr('markerHeight',5)
        .attr('xoverflow','visible')
        .append('svg:path')
        .attr('d', 'M 0, -5 L 10 ,0 L 0,5')
        .attr('fill', '#999')
        .style('stroke','none');

  container = svg.append("g");
		
  graphLayout = d3.forceSimulation()
	.force("link", d3.forceLink().id(function(d) { return d.msid; }))
	.nodes(_nodes)
    .force("charge", d3.forceManyBody().strength(-3000))
    .force("center", d3.forceCenter(width / 2, height / 2))
    .force("x", d3.forceX(width / 2).strength(1))
    .force("y", d3.forceY(height / 2).strength(1))
    .force("link", d3.forceLink(_edges).id(function(d) {return d.msid; }).distance(50).strength(1))
    .on("tick", ticked);
		
  svg.call(
    d3.zoom()
        .scaleExtent([.1, 4])
        .on("zoom", function() { container.attr("transform", d3.event.transform); })
  );

  link = container.append("g").attr("class", "links")
    .selectAll("line")
    .data(_edges)
    .enter()
    .append("line")
    .attr("class", "link")
    .attr('marker-end','url(#arrowHead)')
    .attr("stroke", "#aaa")
    .attr("stroke-width", "1px");

  node = container.append("g").attr("class", "nodes")
    .selectAll("g")
    .data(_nodes)
    .enter()
    .append("circle")
    .attr("r", 5)
    .attr("fill", function(d) { if(d.key){ return "green"; } else { return "red"; } } );
		
  node.on("mouseover", focus).on("mouseout", unfocus);

  node.call(
    d3.drag()
        .on("start", dragstarted)
        .on("drag", dragged)
        .on("end", dragended)
  );

  labelNode = container.append("g").attr("class", "labelNodes")
    .selectAll("text")
    .data(_nodes)
    .enter()
    //.append("a")
    //.attr("xlink:href", "http://whatever.com")		
    .append("text")
    .text(function(d) { return d.key; })
    .style("fill", "#555")
    .style("font-family", "Arial")
    .style("font-size", 12)
    .style("pointer-events", "none"); // to prevent mouseover/drag capture


  node.on('click', function(paper) {
    var paperText = "<div class='menuItem'>Publication Data</div>";
    for (var field of paperFields)
    {
	    if(paper[field])
	    {
		    if(field === "url")
	      {
          paperText += "<div><b>"+field+"</b>: <a target='_blank' href='"+paper[field]+"'>"+paper[field]+"</a></div>";
		    }
		    else if(field === "doi")
	      {
          paperText += "<div><b>"+field+"</b>: <a target='_blank' href='http://www.doi.org/"+paper[field]+"'>"+paper[field]+"</a></div>";
	      }
		    else
		    {
          paperText += "<div><b>"+field+"</b>: "+paper[field]+"</div>";
	      }
	    }
    }

	  paperInfo.html(paperText);

	  var win = window.frames.viewerFrame.contentWindow;

    win.postMessage(paper.language, 'https://vrozen.github.io/LoGaP:8080');
    		
	  //win.postMessage(paper.language, 'http://127.0.0.1:8000');
    //summary.html(d.keywords);
    //viewer.html("<iframe width='100%' height='100%' src='pdfjs/web/viewer.html?"+file+"#search='"+query+"'></iframe>");
    //summary.html("<input name='close' type='button' value='Close' id='Close'/><iframe src='pdfjs/web/viewer.html'></iframe>");
  })
		
  node.on("mouseover", focus).on("mouseout", unfocus);
}

//https://stackoverflow.com/questions/29987478/pdf-js-using-search-function-on-embedded-pdf
function searchPDF(td_text) {
    PDFView.findBar.open();
    $(PDFView.findBar.findField).val(td_text);
    $("#tableDiv").focus();

    var event = document.createEvent('CustomEvent');
    event.initCustomEvent('find', true, true, {
        query: td_text,
        caseSensitive: $("#findMatchCase").prop('checked'),
        highlightAll: $("#findHighlightAll").prop('checked'),
        findPrevious: undefined
    });
    return event;
}
		
function ticked() {
    node.call(updateNode);
    link.call(updateLink);
    labelNode.call(updateNode);		
}

function fixna(x) {
    if (isFinite(x)) return x;
    return 0;
}

function focus(d) {
    var index = d3.select(d3.event.target).datum().index;
    node.style("opacity", function(o) {
        return neigh(index, o.index) ? 1 : 0.1;
    });
    //labelNode.attr("display", function(o) {
    //  return neigh(index, o.node.index) ? "block": "none";
    //});
    link.style("opacity", function(o) {
        return o.source.index == index || o.target.index == index ? 1 : 0.1;
    });
}

function unfocus() {
   //labelNode.attr("display", "block");
   node.style("opacity", 1);
   link.style("opacity", 1);
}

function updateLink(link) {
    link.attr("x1", function(d) { return fixna(d.source.x); })
        .attr("y1", function(d) { return fixna(d.source.y); })
        .attr("x2", function(d) { return fixna(d.target.x); })
        .attr("y2", function(d) { return fixna(d.target.y); });
}

function updateNode(node) {
    node.attr("transform", function(d) {
        return "translate(" + fixna(d.x) + "," + fixna(d.y) + ")";
    });
}

function dragstarted(d) {
    d3.event.sourceEvent.stopPropagation();
    if (!d3.event.active) graphLayout.alphaTarget(0.3).restart();
    d.fx = d.x;
    d.fy = d.y;
}

function dragged(d) {
    d.fx = d3.event.x;
    d.fy = d3.event.y;
}

function dragended(d) {
    if (!d3.event.active) graphLayout.alphaTarget(0);
    d.fx = null;
    d.fy = null;
}

//Updates the graph visibility, including only publications by a specific author.
//input: string name
//output: null
function filterByAuthor(name)
{
  storeNodes.forEach(function(article) {
	  result = false;
    if(article.author)
	  {
	    if(article.author.toLowerCase().includes(name))
	    {
	      result = true;
	    }
    }
	  article.visible = article.visible && result;
  });
}

function filterByYear(lowYear, highYear)
{
  storeNodes.forEach(function(article) {
	result = false;		
    if(article.year)
	{
	  if(article.year >= lowYear && article.year <= highYear)
	  {
		result = true;
	  }
    }
	article.visible = article.visible && result;	
  });
}

function filterByTitle(word)
{
  storeNodes.forEach(function(article) {
	  result = false;		
    if(article.title)
	  {
	    if(article.title.toLowerCase().includes(word))
	    {
		    result = true;
	    }
    }
	  article.visible = article.visible && result;
  });
}

function filterByLanguage(language)
{
  storeNodes.forEach(function(article) {
    result = false;		
    if(article.language)
    {
      if(article.language.toLowerCase() === language)
      {
        result = true;
      }
    }
    article.visible = article.visible && result;
  });
}

langBox = d3.select("#language");
foundLanguages = [];
_nodes.forEach(function(n) {
  if(n.language)
  {
    if(!foundLanguages.includes(n.language))
    {
      foundLanguages.push(n.language);
    }
  }
});

foundLanguages.sort();

foundLanguages.forEach(function(language) {
    langBox.append("option")
	.text(language)
	.attr("value", language);
  });

document.getElementById("author").addEventListener('keydown', (e) => {
  if (e.key === 'Enter') { search(e); }
});

document.getElementById("title").addEventListener('keydown', (e) => {
  if (e.key === 'Enter') { search(e); }
});

document.getElementById("lowYear").addEventListener('keydown', (e) => {
  if (e.key === 'Enter') { search(e); }
});

document.getElementById("highYear").addEventListener('keydown', (e) => {
  if (e.key === 'Enter') { search(e); }
});

document.getElementById("language").onchange = searchLanguage;

function searchLanguage() {
  language = d3.select("#language").property("value");

  document.getElementById("author").value = "";

  document.getElementById("lowYear").value = "";

  document.getElementById("highYear").value = "";

  document.getElementById("title").value = "";

  storeNodes.forEach(function(n) { n.visible = true;});

  filterByLanguage(language.toLowerCase());

  //var win = window.frames.viewerFrame.contentWindow;

  var win = window.frames['viewerFrame'].contentWindow

  win.postMessage(language, 'https://vrozen.github.io/LoGaP:8080');

  filter();
  update();
};

function search() {
  author = document.getElementById("author").value.toLowerCase();

  lowYear = document.getElementById("lowYear").value;

	highYear = document.getElementById("highYear").value;

	title = document.getElementById("title").value.toLowerCase();

  document.getElementById("language").selectedIndex = "-1";
		
  storeNodes.forEach(function(n) { n.visible = true;});
		
  if(author !== "")
  {
    filterByAuthor(author);
  }

	if(lowYear !== "" || highYear !== "")
	{
    if(lowYear === "")
  	{
	    lowYear = 0;
  	}
    if(highYear === "")
    {
      highYear = 9999;
    }		
	  filterByYear(lowYear, highYear);
	}
		
	if(title !== "")
	{
	  filterByTitle(title);
	}

  filter();
  update();
};


		
function filter() {
	_nodes = new Array();
  _edges = new Array();		
		
	storeNodes.forEach(function(n) {
	  if (n.visible) {
		  _nodes.push(n);
	  }
	});

	storeEdges.forEach(function(e) {
    if(_nodes.includes(e.source) && _nodes.includes(e.target))
	  {
	    _edges.push(e);
	  }
	});
}
//}); // d3.json
</script>
</body>
</html>
